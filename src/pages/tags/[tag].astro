---
import Default from "../../layouts/Default.astro";
import Title from "../../components/commons/Title.astro";
import ListPreviewArticles from "../../components/articles/ListPreviewArticles.astro";

import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const allArticles = await getCollection("articles");
  const uniqueTags = [
    ...new Set(allArticles.flatMap((post) => post.data.tags || [])),
  ];

  return uniqueTags.map((tag) => ({ params: { tag } }));
}

const tag = Astro.params.tag;
const allArticles = await getCollection("articles");
const filteredArticles = allArticles.filter(
    (article) => article.data.tags && article.data.tags.includes(tag)
  );
---

<Default>
  <Title title={`Articles avec le tag "${tag}"`} icon="mdi:tag" />
  <ListPreviewArticles articles={filteredArticles} />
</Default>
