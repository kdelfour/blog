---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

import FormattedDate from "../../components/FormattedDate.astro";
import SubTitle from "../commons/SubTitle.astro";
interface ListBooksProps {
  slice?: number;
}

const { slice } = Astro.props as ListBooksProps;

const allPosts = (await getCollection("books")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const posts = slice ? allPosts.slice(0, slice) : allPosts;
---

<section class="grid grid-cols-2 gap-4">
  {
    posts.map((post) => (
      <div class="flex flex-col items-center">
        <a
          href={import.meta.env.BASE_URL + `books/${post.slug}/`}
          class="text-center"
        >
          <Image
            width={320}
            height={480}
            src={import.meta.env.BASE_URL + post.data.cover}
            alt={`Couverture du livre ${post.data.title}`}
            class="mx-auto rounded-lg"
          />
          <div>
            <SubTitle title={post.data.title} />
            <span class="text-gray-300 text-sm">{post.data.author}</span>
            <p class="text-gray-300 text-sm">
              Publi√© le <FormattedDate date={post.data.pubDate} />
            </p>
          </div>
        </a>
      </div>
    ))
  }
</section>
