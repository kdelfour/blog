---
import { getCollection } from "astro:content";
import PreviewArticle from "./PreviewArticle.astro";

interface Article {
  slug: string;
  data: {
    pubDate: string;
    cover: string;
    title: string;
    description: string;
  };
}

interface ListArticlesProps {
  articles?: Article[];
  slice?: number;
}

const { articles, slice } = Astro.props as ListArticlesProps;

let posts;
if (articles) {
  posts = articles;
} else {
  const allPosts = (await getCollection("articles"))
    .filter((post) => new Date(post.data.pubDate) <= new Date())
    .sort(
      (a, b) =>
        new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf()
    );

  posts = slice ? allPosts.slice(0, slice) : allPosts;
}
---

<section class="grid md:grid-cols-3 sm:grid-cols-1 gap-4">
  {posts.map((post) => <PreviewArticle post={post} />)}
</section>
